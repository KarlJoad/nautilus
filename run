#!/bin/bash

set -e

ARCH=riscv
CROSS_COMPILE=/opt/homebrew/bin/riscv64-unknown-elf-

if [[ "$TOOLCHAIN_OVERRIDE" != "" ]]; then
  CROSS_COMPILE=$TOOLCHAIN_OVERRIDE
fi

ARCH=riscv CROSS_COMPILE=$CROSS_COMPILE make -j


if [[ "$*" != *"qemu"* ]]; then
	echo not qemu
else
  echo 'Starting QEMU...'
  printf '%*s\n' "${COLUMNS:-$(tput cols)}" '' | tr ' ' _
  qemu-system-riscv64 -nographic -machine sifive_u -m 2G -bios default -kernel nautilus.bin -gdb tcp::1234
fi

